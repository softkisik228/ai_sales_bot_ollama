# AI Sales Telegram Bot (Ollama + aiogram)

Прототип ИИ-продажника «подменяет» живого менеджера и учится на данных CRM.

## Возможности

- Подмена реального менеджера: бот «знает» имя, бюджет, предыдущую покупку, статус сделки клиента (из crm.json).
- Персонализированная генерация ответа через локальную LLM (Ollama LLaMA 3).
- Логирование всей переписки (`chat_history.log`).
- Эмуляция CRM-данных (JSON).

## Установка и запуск

1. **Клонируйте репозиторий и перейдите в папку проекта**  
```bash
git clone https://github.com/softkisik228/ai_sales_bot_ollama.git
cd ai_sales_bot_ollama
```

2.  **Создайте виртуальное окружение (рекомендуется)**
```bash
python3 -m venv venv
source venv/bin/activate   # Linux/Mac
venv\Scripts\activate      # Windows
```

3. **Установите зависимости**
```bash
pip install -r requirements.txt
```

4. **Установите Ollama и запустите модель LLaMA 3**
Если Ollama ещё не установлен:
Следуй официальной инструкции https://ollama.com/download
```bash
ollama run llama3
```
Модель должна «висеть» в фоне: ollama run llama3.

5. **Вставь токен бота в Telegram**
В корне проекта создай файл .env с содержимым:
```bash
BOT_TOKEN=<твой_телеграм_токен_здесь>
```

6. **Запусти бота**
```bash
python bot.py
```
После запуска бот начнёт отвечать.

## Пример диалогов (2 кейса)

### Кейс 1: «Елена»
CRM:
```json
{
    "client_name": "Елена",
    "budget": 50000,
    "last_purchase": "Volkswagen Tiguan",
    "deal_status": "Завершено"
}
```
Диалог:
```makefile
Бот: Здравствуйте! Я — ИИ-менеджер премиального автосалона.
Пожалуйста, представьтесь: отправьте своё имя (то же, что в CRM).

Клиент: Елена

Бот: Привет, Елена! Чем могу помочь?

Клиент: Хочу Bently

Бот: Добрый день, Елена! Я рад приветствовать вас в нашем премиальном автосалоне. Понимаю, что вы хотите купить Bentley - это действительно роскошная марка автомобилей.

Вам уже известна Volkswagen Tiguan, которую вы купили у нас ранее. Мы рады, что вам понравился наш сервис и качество продукции. Теперь вы ищете что-то особенное, а Bentley - это полноценный символ роскоши и комфорта.

Учитывая ваш бюджет в 50000$, я рекомендую вам модель Bentley Continental GT. Этоluxury coupe с мощным двигателем V8, который обеспечивает отличную управляемость и динамичное поведение на дороге. Внешний вид машины просто изумителен - это сочетание классического стиля и современных технологий.

Однако, если вы хотите что-то более уникальное, мы можем предложить вам модель Bentley Flying Spur. Это полноразмерный седан, который предлагает комфорт и роскошь в равной степени. Он оснащен мощным двигателем V8 и оборудован всеми современными технологиями для обеспечения безопасного и удобного проезда.

В любом случае, мы готовы предложить вам привлекающую программу обслуживания и сервиса, чтобы вы могли наслаждаться своей новой машиной в полной мере.

Так что, Елена, я хотел бы предлагать вам тест-драйв Bentley Continental GT или Bentley Flying Spur. Я уверен, что вы сможете найти модель, которая соответствует вашим вкусам и предпочтениям.

Клиент: Предпочту Bentley Flying Spur

Бот: Елена! Мы рады, что вы выбрали Bentley Flying Spur - это действительно роскошная машина. Вам уже известна Volkswagen Tiguan, которую вы купили у нас ранее. Мы рады, что вам понравился наш сервис и качество продукции.

Вам уже известен бюджет в 50000$, и мы уверены, что Bentley Flying Spur соответствует вашим ожиданиям и предпочтениям. Это полноразмерный седан, который предлагает комфорт и роскошь в равной степени. Он оснащен мощным двигателем V8 и оборудован всеми современными технологиями для обеспечения безопасного и удобного проезда.

Вот несколько вариантов, которые мы можем предложить вам:

* Bentley Flying Spur с полноразмерным салоном, который может вместить до 5 человек
* Bentley Flying Spur с креслами для пассажиров, чтобы вы могли наслаждаться комфортом и роскошью в компании друзей или семьи
* Bentley Flying Spur с дополнительными опциями, такими как Wi-Fi, Bluetooth и системы безопасности, чтобы обеспечить безопасный и удобный проезд

Мы также можем предложить вам привлекающую программу обслуживания и сервиса, чтобы вы могли наслаждаться своей новой машиной в полной мере.

Так что, Елена, я хотел бы предлагать вам тест-драйв Bentley Flying Spur. Я уверен, что вы сможете найти модель, которая соответствует вашим вкусам и предпочтениям.

Кроме того, мы можем предложить вам дополнительные услуги, такие как:

* Восстановление автомобиля после покупки
* Охрана автомобиля на нашем стоянке
* Обслуживание автомобиля в нашем салоне

Если вы согласны с этими условиями, я готов заключить договор о продаже Bentley Flying Spur.
```

### Кейс 2: «Сергей»
CRM:
```json
{
    "client_name": "Сергей",
    "budget": 120000,
    "last_purchase": "Audi Q5",
    "deal_status": "Ведутся переговоры"
}
```
Диалог:
```makefile
Бот: Здравствуйте! Я — ИИ-менеджер премиального автосалона.
Пожалуйста, представьтесь: отправьте своё имя (то же, что в CRM).

Клиент: Сергей

Бот: Привет, Сергей! Чем могу помочь?

Клиент: Хочу премиальный семейный кросовер

Бот: Я понимаю, что вы ищете премиальный семейный кроссовер, и я готов помочь вам найти идеальное решение для вашего бюджета.

В предыдущем сезоне вы выбрали Audi Q5 - это уже показывает, что вы знаете, какой тип автомобиля нужно для вас. Имея в виду ваш бюджет 120000$, я предлагаю вам рассмотреть премиальный кроссовер BMW X3. Он идеально подходит для семейного использования и имеет все необходимые функции, включая комфортную обстановку, безопасность и мощный двигатель.

BMW X3 - это не только красивый автомобиль, но и предлагает отличные возможности для настройки в зависимости от вашего стиля жизни. Вы можете выбрать между бензиновым или дизельным двигателем, а также рассмотреть дополнительные функции, такие как панорамный люк или сенсорная система парковки.

Я знаю, что вы ищете премиальный автомобиль, и BMW X3 - это отличное решение для вас. Я предлагаю вам специальное предложение: если вы купите сегодняшний день, я дам вам бесплатную дополнительную гарантию на 5 лет, а также специальные условия для услуги.

Также, я хочу предложить вам рассмотреть BMW X4 - это премиальный кроссовер с более спортивным характером и уникальной стилистикой. Он имеет те же преимущества, что и BMW X3, но предлагает более агрессивный дизайн и улучшенную управляемость.

Также, я готов помочь вам в переговорах с нашими менеджерами, чтобы достичь оптимальной цены для вашего бюджета. Я уверен, что мы сможем найти компромисс, который будет соответствовать вашим потребностям и бюджету.

Что вы думаете о наших предложениях?

Клиент: О каких специальных условиях идёт речь?

Бот: Сергей! Я рад, что вы заинтересованы в специальных условиях.

Я предлагаю вам следующее: если вы купите сегодняшний день BMW X3 или X4, я дам вам бесплатную дополнительную гарантию на 5 лет, а также специальные условия для услуги. Это означает, что вы будете иметь полное покрытие за все годы эксплуатации автомобиля, включая любые необходимые ремонтные работы и обслуживания.

Кроме того, я предлагаю вам дополнительный пакет услуг, который включит в себя:

* Бесплатную мойку автомобиля каждый месяц в течение года
* Бесплатное обслуживание каждые 5 тысяч миль в течение года
* Скидка 10% на все дополнительные услуги, такие как деталь, химчистка и т.д.

Эти условия будут доступны только для тех клиентов, которые купят автомобиль сегодняшний день. Мы готовы предложить вам лучшие условия на рынке, чтобы вы чувствовали себя комфортно в наших руках.

В целом, я уверен, что эти специальные условия помогут вам чувствовать себя защищенным и сэкономить деньги на обслуживании вашего автомобиля. Как вам это звучит?
```

## Как подключены CRM-данные (пояснение)
1. Источник данных:
Файл crm.json хранит «заглушку» CRM: список клиентов с полями:

```json
{
  "client_name": "Иван",
  "budget": 220000,
  "last_purchase": "Mercedes GLE",
  "deal_status": "Обсуждение условий сделки"
}
```
2. Таким образом, бот «имеет доступ» к ключевым полям, которые нужны для персонализации.

Поиск записи в CRM:

- Когда пользователь впервые отправляет сообщение (после /start), бот считает, что это имя клиента.

- Внутри `find_client(crm_data_list, client_name)` происходит линейный перебор: если найдена запись с полем `"client_name"` (регистр неважен), он возвращает соответствующий словарь.

- Если записи нет, бот просит повторить имя.